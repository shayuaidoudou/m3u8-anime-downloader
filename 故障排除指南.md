# 故障排除指南

## 🔧 问题诊断步骤

### 1. 运行调试模式
现在启动脚本会自动使用调试模式，提供详细的错误信息：

**Windows:**
```batch
run.bat
```

**Linux/macOS:**
```bash
./run.sh
```

### 2. 使用命令行测试工具
如果GUI有问题，可以使用命令行工具进行测试：

```bash
python test_download.py
```

这个工具提供两个功能：
- 测试M3U8解析：只解析不下载，检查链接是否有效
- 测试完整下载：完整的下载流程测试

### 3. 手动检查环境
```bash
python debug_launcher.py
```

这会检查：
- Python版本
- 依赖包安装情况
- 模块导入是否正常

## ❓ 常见问题和解决方案

### 问题1：ImportError: cannot import name 'pyqtSignal'
**已修复** ✅ - 这是PySide6和PyQt的差异，现在使用正确的`Signal`

### 问题2：正在解析M3U8文件然后直接下载失败

**可能原因和解决方案：**

1. **M3U8链接无效**
   ```
   [DEBUG] 请求M3U8文件: your_url
   [DEBUG] 响应状态码: 404/403/500
   ```
   解决：检查链接是否正确，是否需要特殊请求头

2. **网络连接问题**
   ```
   [ERROR] 网络请求失败: Connection timeout
   ```
   解决：检查网络连接，尝试使用VPN

3. **M3U8格式不正确**
   ```
   [WARNING] M3U8文件没有标准开头
   [DEBUG] 内容预览: <html>404 Not Found</html>
   ```
   解决：确认链接返回的是M3U8文件而不是网页

4. **主播放列表问题**
   ```
   [DEBUG] 检测到主播放列表，查找子播放列表...
   ```
   解决：程序会自动处理，如果失败说明子播放列表链接有问题

5. **权限问题**
   ```
   [ERROR] 输出路径无效: 没有写入权限
   ```
   解决：选择有写入权限的目录

6. **片段下载失败**
   ```
   [ERROR] 所有片段下载都失败了
   ```
   解决：检查片段URL是否需要特殊请求头或防盗链

### 问题3：AES解密失败

**调试信息：**
```
[DEBUG] 检测到加密: {'method': 'AES-128', 'uri': 'key_url'}
[ERROR] AES解密失败: 获取AES密钥失败
```

**解决方案：**
- 确保能够访问密钥服务器
- 检查密钥URL是否需要特殊的请求头
- 某些非标准加密方式可能不支持

## 🛠️ 调试技巧

### 1. 查看详细日志
现在所有操作都有详细的调试输出，格式为：
- `[DEBUG]` - 调试信息
- `[ERROR]` - 错误信息
- `[WARNING]` - 警告信息
- `[PROGRESS]` - 进度信息

### 2. 测试M3U8链接
在浏览器中直接访问M3U8链接，确认：
- 返回的是文本文件，不是网页
- 内容以`#EXTM3U`开头
- 包含`.ts`片段链接

### 3. 手动测试片段下载
复制一个TS片段链接，在浏览器中访问，确认：
- 能够正常下载
- 文件大小合理（通常几百KB到几MB）
- 不需要特殊的请求头

### 4. 检查网络环境
- 确保网络连接稳定
- 如果是国外视频，可能需要VPN
- 检查防火墙设置
- 某些网络环境可能阻止批量下载

## 📋 报告问题时请提供

1. **完整的错误日志**（从开始解析到最终失败的所有输出）
2. **M3U8链接**（如果可以分享的话）
3. **系统信息**（Windows/Linux/macOS版本）
4. **Python和依赖版本**
5. **网络环境信息**（是否使用VPN等）

## 🎯 快速诊断命令

```bash
# 检查环境
python debug_launcher.py

# 测试单个链接解析
python test_download.py
# 选择选项 2：测试M3U8解析

# 测试完整下载（小文件）
python test_download.py  
# 选择选项 1：测试完整下载
```

这样可以快速定位问题所在！
