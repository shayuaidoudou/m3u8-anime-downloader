# M3U8下载器 - 请求头使用说明

## 🔐 功能介绍

很多视频网站会使用请求头检查来防止盗链和爬虫访问。我们的下载器现在支持自定义请求头，可以绕过这些限制。

## 📋 GUI界面使用方法

### 1. 使用预设模板

在主界面的**"反PA模板"**下拉框中，我们提供了几种常用的模板：

- **默认（无特殊请求头）** - 标准下载
- **通用模拟** - 适用于大多数网站的通用请求头
- **A TV** - 专门为Aigua TV网站优化的请求头
- **移动端模拟** - 模拟移动设备访问

选择模板后，状态栏会显示"已选择模板: xxx"。

### 2. 自定义请求头

1. 点击**"请求头设置"**按钮
2. 在弹出的对话框中输入请求头
3. 支持两种格式：

**JSON格式：**
```json
{
    "referer": "https://xxxx.tv/",
    "origin": "https://xxxx.tv",
    "sec-fetch-site": "cross-site"
}
```

**每行一个格式：**
```
referer: https://xxxx.tv/
origin: https://xxxx.tv
sec-fetch-site: cross-site
```

### 3. 添加任务

配置好请求头后，正常添加下载任务。任务会自动使用您设置的请求头。

状态栏会显示：**"已添加任务: xxx (包含 N 个自定义请求头)"**

## 🛠️ 命令行测试工具

运行 `python debug_launcher.py` 然后选择 **"3. 测试自定义请求头功能"**

这个工具可以：
- 测试特定网站（如Aigua TV）的请求头
- 自定义测试任意M3U8链接
- 只测试解析不下载，快速验证请求头是否有效


在GUI中，您可以：
1. 直接选择 **"Aigua TV"** 模板
2. 或者点击**"请求头设置"**手动输入这些请求头

## 🔍 调试技巧

1. **先测试解析：** 
   使用命令行工具选择"测试M3U8解析"，快速验证请求头是否正确

2. **查看调试输出：**
   现在所有网络请求都会显示详细的调试信息，包括：
   - 使用的请求头
   - 服务器响应状态
   - 内容预览

3. **常见问题排查：**
   - `403 Forbidden` → 需要添加referer或origin
   - `404 Not Found` → 检查URL是否正确
   - 解析成功但下载失败 → TS片段可能需要相同的请求头

## 🎯 最佳实践

1. **优先使用预设模板** - 我们已经测试过的常用配置
2. **从浏览器复制** - 使用F12开发者工具查看网络请求
3. **测试后使用** - 先用命令行工具测试，确认有效后再GUI下载
4. **保存配置** - 对于常用网站，可以记录有效的请求头配置

## ⚠️ 注意事项

- 请求头会应用到所有网络请求（M3U8文件、TS片段、加密密钥）
- 某些网站可能需要动态生成的请求头，这种情况下可能仍然无法下载
- 请遵守网站的使用条款和相关法律法规

---

现在您可以轻松下载那些有反爬虫保护的M3U8视频了！🎉
